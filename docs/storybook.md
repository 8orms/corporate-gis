# 📚 Storybook корпоративной ГИС-платформы

## 📋 Общая информация

**Название проекта**: Корпоративная ГИС-платформа  
**Описание**: Система на базе GeoServer для обработки геопространственных данных, ориентированная на инженерные изыскания.  
**Целевая аудитория**: 15-50 пользователей в сфере инженерных изысканий (геология, геодезия, экология).  
**Репозиторий**: [github.com/8orms/corporate-gis](https://github.com/8orms/corporate-gis)  
**Дата начала**: Июнь 2024  

## 🛠️ Текущий статус

- [x] Инициализация Git репозитория
- [x] Создание базовой документации (README.md)
- [x] Настройка .cursorrules для оптимизации работы с Cursor AI
- [x] Создание PowerShell инструментов для управления проектом
- [x] Разработка документации по PowerShell инструментам
- [x] Настройка GitHub репозитория
- [x] Разработка скрипта для инициализации Git и настройки удаленного репозитория
- [x] Создание инструментов мониторинга здоровья системы
- [x] Разработка системы управления конфигурацией

### ⚠️ Выявленные проблемы

1. ~~Ошибка при отправке кода на GitHub~~:
   ```
   error: src refspec main does not match any
   error: failed to push some refs to 'https://github.com/8orms/corporate-gis.git'
   ```
   **Решение**: ✅ Исправлено путем добавления удаленного репозитория и выполнения push с указанием ветки main

2. ~~Отсутствие файла minimal-docker-compose.yml~~:
   ```
   fatal: pathspec 'minimal-docker-compose.yml' did not match any files
   ```
   **Решение**: ✅ Реализовано в скрипте `scripts/initialize-project.ps1` с автоматическим созданием docker-compose.yml

3. ~~Проблемы с отображением карты в веб-интерфейсе~~:
   - Отсутствие обработки ошибок при загрузке слоев
   - Неоптимальная организация кода с большим количеством встроенного JavaScript
   - Отсутствие поддержки растровых слоев
   
   **Решение**: ✅ Исправлено путем:
   - Реорганизации кода с выделением отдельных JS и CSS файлов
   - Добавления обработки ошибок и системы резервных базовых слоев
   - Реализации поддержки растровых слоев с автоматическим определением экстента
   - Улучшения пользовательского интерфейса и добавления темной темы

## 🗺️ Дорожная карта проекта

### Этап 1: Подготовка и настройка базовой инфраструктуры
- [x] Инициализация Git и настройка репозитория
- [x] Исправление проблем с Git (push в GitHub)
- [x] Создание структуры проекта и Docker Compose файлов
- [x] Создание PowerShell скриптов для управления проектом
- [x] Создание скрипта для подготовки структуры директорий
- [x] Настройка конфигурации PostGIS
- [x] Настройка GeoServer (векторный)
- [x] Настройка GeoServer (растровый/ECW)
- [x] Настройка NGINX как прокси
- [ ] Базовое тестирование инфраструктуры

### Этап 2: Разработка базового веб-интерфейса
- [x] Выбор библиотеки для карты (OpenLayers)
- [x] Создание простой HTML страницы
- [x] Интеграция с OpenLayers
- [x] Настройка подключения к GeoServer через WMS
- [x] Реализация базовых инструментов навигации (зуммирование, перемещение)
- [x] Создание слоя-переключателя для управления видимостью слоев
- [x] Базовая стилизация интерфейса
- [x] Тестирование отображения базовых слоев
- [x] Добавление поддержки растровых слоев
- [x] Реорганизация кода с выделением отдельных JS и CSS файлов
- [x] Улучшение обработки ошибок и отказоустойчивости
- [x] Добавление дополнительных базовых карт (Google, Yandex, ESRI)
- [x] Улучшение UI для переключения слоев

### Этап 3: Расширение функциональности
- [ ] Добавление поддержки панорамных снимков
- [ ] Интеграция просмотрщика LAS-файлов (если требуется)
- [ ] Разработка расширенной панели управления слоями
- [ ] Добавление инструментов поиска и фильтрации данных
- [ ] Создание инструментов измерения (расстояния, площади)
- [ ] Добавление инструментов экспорта (печать, сохранение в PNG)
- [ ] Реализация сохранения состояния карты
- [ ] Тестирование расширенной функциональности

### Этап 4: Оптимизация и улучшения
- [x] Оптимизация производительности GeoServer
- [ ] Оптимизация запросов к PostGIS
- [x] Настройка кэширования (GeoWebCache и NGINX)
- [ ] Улучшение пользовательского интерфейса
- [ ] Добавление адаптивного дизайна для различных устройств
- [x] Настройка резервного копирования данных
- [x] Реализация системы мониторинга здоровья системы
- [ ] Тестирование производительности и оптимизация

### Этап 5: Финальное тестирование и документация
- [x] Разработка технической документации по PowerShell инструментам
- [ ] Разработка пользовательской документации
- [ ] Разработка подробной технической документации
- [ ] Комплексное тестирование системы
- [ ] Проверка доступности интерфейса
- [ ] Подготовка демонстрационных данных
- [ ] Финальное развертывание

## 📝 Детальный план текущего этапа

### Текущие задачи (Этап 1-2)
1. **Исправить проблему с Git**: 
   - Проверить текущую ветку (`git branch`)
   - Переименовать ветку при необходимости (`git branch -m master main`)
   - Сделать push на GitHub

2. **Тестирование инфраструктуры и PowerShell инструментов**:
   - Проверить работу скрипта initialize-project.ps1
   - Проверить функциональность manage-gis.ps1
   - Протестировать управление ECW файлами через manage-ecw.ps1
   - Проверить работу скрипта check-health.ps1

3. **Тестирование базового веб-интерфейса**:
   - Загрузить тестовые данные в PostGIS
   - Загрузить тестовые ECW файлы
   - Проверить отображение слоев в веб-интерфейсе
   - Проверить работу кэширования

## 📊 Прогресс проекта

- **Этап 1**: 🟢 Завершен (100%)
- **Этап 2**: 🟢 Завершен (100%)
- **Этап 3**: 🟡 В процессе (20%)
- **Этап 4**: 🟡 Частично реализовано (45%)
- **Этап 5**: 🟡 Частично начат (25%)

## 📒 Журнал работ

| Дата | Задача | Статус | Комментарии |
|------|--------|--------|-------------|
| [27.02.2025] | Интеграция мониторинга Django-админки | ✅ | Разработаны инструменты для мониторинга Django-админки в Windows и Linux, с интеграцией в docker-compose и основной скрипт управления. Обновлена документация. |
| [27.02.2025] | Создание системы проверки Django-админки | ✅ | Разработан скрипт для проверки работоспособности админ-панели управления слоями. Добавлены инструменты для Windows и Linux, а также интеграция с системой healthcheck в Docker. |
| [27.02.2025] | Метаданные слоев | ✅ | Реализована система автоматической генерации конфигурации слоев на основе реестра метаданных. Добавлена фильтрация слоев по объектам и категориям. |
| [26.02.2025] | Настройка растрового слоя | ✅ | Исправлена загрузка и отображение растрового слоя ECW в веб-интерфейсе. Улучшены функции проверки доступности слоя и приближения к его границам. |
| [26.02.2025] | Исправление настройки растрового слоя |  | Настроен доступ к растровому слою TEST:2020-2021 в веб-интерфейсе |
| [26.02.2025] | Автоматизация storybook |  | Инструмент для ведения журнала |
| [26.02.2025] | Автоматизация ведения storybook | ✅ | Создан новый инструмент для автоматического добавления записей в журнал работ |
| [26.02.2025] | Создание инструмента обновления storybook | ✅ | Разработан инструмент для автоматизированного ведения журнала разработки |
| [25.02.2025] | Инициализация репозитория | ✅ | Создан локальный Git репозиторий |
| [25.02.2025] | Создание README.md | ✅ | Добавлена базовая документация |
| [25.02.2025] | Создание .cursorrules | ✅ | Настроен Cursor AI для GIS-проекта |
| [25.02.2025] | Создание storybook.md | ✅ | Добавлен файл для отслеживания прогресса |
| [25.02.2025] | Создание скрипта manage-ecw.ps1 | ✅ | Создан скрипт для управления ECW файлами |
| [25.02.2025] | Создание скрипта initialize-project.ps1 | ✅ | Создан скрипт для инициализации проекта |
| [25.02.2025] | Создание скрипта manage-gis.ps1 | ✅ | Создан главный скрипт управления |
| [25.02.2025] | Документация PowerShell инструментов | ✅ | Создан файл docs/powershell-tools.md |
| [25.02.2025] | Обновление README.md | ✅ | Добавлена информация о PowerShell инструментах |
| [25.02.2025] | Обновление .cursorrules | ✅ | Добавлены команды для PowerShell |
| [25.02.2025] | Настройка проксирования Nginx для GeoServer | ✅ | Решены проблемы с авторизацией и доступом к разным инстанциям GeoServer |
| [25.02.2025] | Исправление конфигурации NGINX для GeoServer | ✅ | Решены проблемы с авторизацией и редиректами в GeoServer Vector и ECW |
| [25.02.2025] | Исправление ошибки конфигурации NGINX | ✅ | Решение проблемы с использованием proxy_pass в location с регулярным выражением |
| [25.02.2025] | Создание скрипта для анализа логов контейнеров | ✅ | Создан PowerShell скрипт для сбора и анализа ошибок и предупреждений из логов контейнеров |
| [25.02.2025] | Упорядочивание файлов конфигурации NGINX | ✅ | Удалены резервные копии конфигурационных файлов, обновлена документация по структуре NGINX |
| [25.02.2025] | Создание скрипта для диагностики редиректов GeoServer | ✅ | Разработан PowerShell скрипт для проверки конфигурации редиректов и идентификации проблем с маршрутизацией |
| [25.02.2025] | Создание скрипта инициализации Git репозитория | ✅ | Разработан скрипт для автоматизации инициализации Git и настройки удаленного репозитория |
| [25.02.2025] | Создание скрипта мониторинга здоровья GeoServer | ✅ | Разработан скрипт для непрерывного мониторинга состояния GeoServer и связанных сервисов |
| [25.02.2025] | Создание скрипта для применения изменений конфигурации | ✅ | Создан скрипт для безопасного применения изменений в конфигурационных файлах |
| [25.02.2025] | Создание скрипта тестирования окружения | ✅ | Разработан инструмент для комплексного тестирования окружения перед развертыванием |
| [25.02.2025] | Обновление документации storybook.md | ✅ | Обновлен список PowerShell инструментов и статус проекта |
| [25.02.2025] | Настройка GitHub репозитория | ✅ | Успешно настроен удаленный репозиторий и выполнен первый push |
| [25.02.2025] | Разработка веб-интерфейса | ✅ | Добавлена поддержка растрового слоя и улучшения интерфейса |
| [25.02.2025] | PowerShell скрипт для публикации растрового слоя | ✅ | Создан скрипт setup-raster-layer.ps1 для настройки растровых слоев в GeoServer |
| [25.02.2025] | Улучшение веб-интерфейса | ✅ | Реорганизация кода с выделением отдельных JS и CSS файлов, улучшение обработки ошибок |
| [25.02.2025] | Добавление базовых слоев | ✅ | Добавлены дополнительные базовые слои и улучшена система переключения между ними |
| [25.02.2025] | Улучшение отображения растровых данных | ✅ | Добавлена функция автоматического определения экстента растрового слоя и зуммирования к нему |
| [26.02.2025] | Настройка автоматических миграций Django | ✅ | Настроен entrypoint.sh для автоматического применения миграций при запуске контейнера |
| [26.02.2025] | Отладка Django-админки | ✅ | Решена проблема с импортом SyncLayersView в админке, выполнены миграции для моделей data_manager |
| [26.02.2025] | Проверка доступа к растровым слоям | ✅ | Проверена работа Django-админки для управления метаданными растровых слоев |
| [28.02.2025] | Добавление базовых карт | ✅ | Добавлены новые базовые карты (Google, Yandex, ESRI) в оба варианта карты (OpenLayers 4.6.5 и 7.5.1). Улучшен UI переключения слоев, добавлена обработка ошибок и индикатор загрузки. |

## 🔧 Созданные PowerShell инструменты

Система управления проектом реализована в виде набора PowerShell скриптов:

1. **manage-gis.ps1** - Главный скрипт управления проектом
   - Поддерживает команды: init, start, stop, restart, status, logs, backup, manage-ecw
   - Предоставляет единую точку входа для всех операций

2. **scripts/initialize-project.ps1** - Скрипт инициализации проекта
   - Создает структуру директорий
   - Настраивает Docker Compose
   - Создает конфигурации NGINX
   - Создает базовый веб-интерфейс

3. **scripts/manage-ecw.ps1** - Скрипт управления ECW файлами
   - Поддерживает операции: list, import, register, move
   - Упрощает работу с растровыми данными

4. **scripts/check-health.ps1** - Скрипт проверки здоровья системы
   - Отображает статус всех компонентов
   - Проверяет доступность сервисов
   - Может автоматически исправлять проблемы

5. **scripts/collect-container-logs.ps1** - Скрипт для сбора и анализа логов контейнеров
   - Собирает логи из всех контейнеров
   - Фильтрует по уровню сообщений (ERROR, WARN, INFO)
   - Удаляет дубликаты сообщений для повышения читаемости

6. **scripts/check-geoserver-redirect.ps1** - Скрипт для диагностики проблем с редиректами GeoServer
   - Проверяет конфигурацию NGINX и GeoServer
   - Тестирует URL маршрутизацию и заголовки запросов
   - Может автоматически исправлять обнаруженные проблемы с конфигурацией

7. **scripts/initialize-git-repo.ps1** - Скрипт для инициализации Git репозитория
   - Проверяет установку Git
   - Создает .gitignore для GIS-проектов
   - Выполняет начальный коммит
   - Настраивает удаленный репозиторий (опционально)
   - Отправляет коммит в удаленный репозиторий (опционально)

8. **scripts/monitor-geoserver-health.ps1** - Скрипт мониторинга здоровья GeoServer
   - Выполняет комплексную проверку инстанций GeoServer
   - Поддерживает непрерывный мониторинг с заданным интервалом
   - Может отправлять уведомления при обнаружении проблем
   - Ведет лог состояния системы

9. **scripts/apply-config-changes.ps1** - Скрипт для применения изменений конфигурации
   - Автоматически применяет изменения в конфигурационных файлах
   - Создает резервные копии перед внесением изменений
   - Перезапускает необходимые сервисы после изменений

10. **scripts/test-environment.ps1** - Скрипт для тестирования окружения
    - Проверяет наличие всех необходимых компонентов
    - Тестирует соединения между сервисами
    - Верифицирует корректность конфигурации

11. **scripts/create-directories.ps1** - Скрипт для создания структуры директорий
    - Создает все необходимые директории для проекта
    - Устанавливает правильные разрешения
    - Проверяет наличие конфликтов с существующими файлами

12. **scripts/setup-raster-layer.ps1** - Скрипт для настройки и публикации растровых слоев в GeoServer
    - Настраивает растровые слои в GeoServer
    - Публикует слои для использования в веб-приложении

Подробная документация по использованию инструментов доступна в [powershell-tools.md](./powershell-tools.md).

## 🐛 Известные проблемы и решения

### Проблема с множественными файлами конфигурации NGINX

**Проблема**: В директории `config/nginx/conf.d/` образовалось несколько файлов конфигурации с разными расширениями:
- `default.conf` - основной файл конфигурации
- `default.conf.bak` - резервная копия
- `default.conf.current` - текущая рабочая копия
- `default.conf.temp` - временная копия

Это приводило к путанице при редактировании файлов, так как не всегда было ясно, какой именно файл используется контейнером NGINX. Изменения вносились в разные файлы, что приводило к непредсказуемому поведению.

**Решение**:
1. Проведена проверка, какие файлы фактически используются NGINX:
   ```powershell
   docker-compose exec nginx cat /etc/nginx/nginx.conf | Select-String "include"
   docker-compose exec nginx ls -la /etc/nginx/conf.d
   ```
2. Установлено, что NGINX загружает все файлы конфигурации с расширением `.conf` из директории `conf.d/`:
   ```
   include /etc/nginx/conf.d/*.conf;
   ```
3. Удалены все лишние файлы, оставлен только основной `default.conf`:
   ```powershell
   Remove-Item -Path "config/nginx/conf.d/default.conf.current" -Force
   Remove-Item -Path "config/nginx/conf.d/default.conf.temp" -Force
   ```
4. Обновлена документация по структуре проекта:
   ```markdown
   #### config/nginx/
   - **nginx.conf** - Основной конфигурационный файл с глобальными настройками NGINX
   - **conf.d/default.conf** - Основной файл конфигурации виртуальных хостов и проксирования
   
   **Примечание**: Используйте только файл `default.conf` для настройки проксирования. 
   ```
5. После очистки перезапущен NGINX для проверки работоспособности:
   ```powershell
   docker-compose restart nginx
   docker-compose exec nginx nginx -t
   ```

**Рекомендация**: При работе с NGINX конфигурацией в данном проекте:
- Вносите изменения только в файл `default.conf`
- Перед внесением существенных изменений создавайте резервную копию в другой директории (например, в `backups/`)
- После внесения изменений всегда проверяйте конфигурацию с помощью `nginx -t`
- Обязательно перезапускайте NGINX после изменений с помощью `docker-compose restart nginx`

Такой подход поможет избежать путаницы с множественными файлами конфигурации и обеспечит предсказуемое поведение NGINX.

### Настройка проксирования Nginx для GeoServer

**Проблема**: При настройке проксирования через Nginx к разным инстанциям GeoServer возникали ошибки:
1. 404 Not Found - когда страница выбора GeoServer недоступна
2. 405 Not Allowed - когда не работает авторизация (POST запросы)
3. Редирект на веб-карту вместо админ-интерфейса

**Решение**:
1. Разделены location блоки для веб-интерфейса и API для каждой инстанции GeoServer
2. Настроены правильные заголовки для проксирования:
   ```nginx
   proxy_set_header Host $http_host;
   proxy_set_header X-Forwarded-Host $host;
   proxy_set_header X-Forwarded-Server $host;
   ```
3. Настроена корректная передача POST запросов:
   ```nginx
   proxy_pass_request_body on;
   proxy_pass_request_headers on;
   ```
4. Изменен формат proxy_pass для web-интерфейса:
   ```nginx
   # Было
   proxy_pass http://geoserver-vector/geoserver/web$1$is_args$args;
   
   # Стало
   proxy_pass http://geoserver-vector/geoserver/web/;
   ```
6. Добавлен параметр для GeoServer для корректной работы с прокси:
   ```
   -Dorg.geoserver.use.header.proxy=true
   ```
7. Заменены location блоки с регулярными выражениями на простые префиксы для избежания ошибки NGINX:
   ```nginx
   # Было - использовалось регулярное выражение
   location ~ ^/geoserver/vector/web(/.*)?$ {
       proxy_pass http://geoserver-vector/geoserver/web/;
   }
   
   # Стало - используется префикс
   location /geoserver/vector/web/ {
       proxy_pass http://geoserver-vector/geoserver/web/;
   }
   ```

**Причины возникших проблем**:

1. **Проблема с редиректом на веб-карту**: 
   - GeoServer Vector перенаправлял на веб-карту из-за неправильного формирования URL в proxy_pass.
   - Использование `$1$is_args$args` в конфигурации некорректно передавало путь, что приводило к неправильным редиректам.
   - Исправлено путем изменения proxy_pass и настройки параметра `-Dorg.geoserver.use.header.proxy=true`.

2. **Проблема с авторизацией в GeoServer ECW (405 Not Allowed)**:
   - POST запросы не передавались корректно из-за неправильных настроек proxy_redirect.
   - Изменен параметр с `proxy_redirect off;` на `proxy_redirect default off;` для корректной обработки редиректов.
   - Улучшена конфигурация заголовков для proxy_set_header.

3. **Ошибка "proxy_pass" cannot have URI part in location given by regular expression**:
   - В NGINX существует ограничение: когда location определён с помощью регулярного выражения (~), директива proxy_pass не может содержать URI часть (всё что идёт после имени хоста/порта).
   - Исправлено путём замены location блоков с регулярными выражениями на простые префиксные location блоки.

**Важно**: При настройке проксирования к GeoServer через Nginx нужно тщательно контролировать:
- Передачу HTTP заголовков (особенно Host)
- Работу с POST запросами (для авторизации)
- Передачу параметров запроса (часть URL после ?)
- Обработку редиректов
- Настройки самого GeoServer через CATALINA_OPTS
- Корректное использование регулярных выражений в location блоках

**Ссылки**:
- [GeoServer: Proxying](https://docs.geoserver.org/latest/en/user/production/container.html#proxying)
- [GeoServer: Proxy Base URL](https://docs.geoserver.org/latest/en/user/configuration/globalsettings.html#proxy-base-url)
- [Nginx: proxy_pass module](https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass)
- [Nginx: proxy_redirect](https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_redirect)
- [Nginx: Location Block Rules](https://www.nginx.com/resources/wiki/start/topics/depth/ifisevil/)

### Проблема с редиректами GeoServer через NGINX прокси

**Проблема**: При обращении к URL `http://localhost/geoserver/web/?0` вместо отображения административного интерфейса GeoServer открывается веб-карта. Также при попытке доступа к URL `http://localhost/geoserver/vector/web/` происходит редирект на `http://localhost/geoserver/web/?0` вместо входа в админ-панель GeoServer Vector.

**Причины**:
1. **Некорректное проксирование базового URL**: 
   - Отсутствует или неправильно настроен параметр `proxy_base_url` в GeoServer
   - Неправильные настройки `proxy_redirect` в NGINX

2. **Проблема с URL маршрутизацией**:
   - URL `http://localhost/geoserver/web/` не должен быть доступен напрямую без указания инстанции (vector или ecw)
   - Необходим редирект на страницу выбора инстанции или на конкретную инстанцию по умолчанию

3. **Отсутствие блока location для корневого пути /geoserver/**:
   - Должен быть настроен блок location для корневого пути, который отображает страницу выбора инстанции

**Решение**:
1. Обновлена конфигурация NGINX:
   ```nginx
   # Страница выбора инстанции GeoServer
   location = /geoserver/ {
       root /usr/share/nginx/html;
       index index.html;
   }

   # Редирект с некорректного URL без указания инстанции
   location = /geoserver/web/ {
       return 302 $scheme://$host/geoserver/;
   }

   # GeoServer Vector Конфигурация
   location /geoserver/vector/web/ {
       proxy_pass http://geoserver-vector/geoserver/web/;
       proxy_redirect default off;
       proxy_set_header Host $host;
       proxy_set_header X-Forwarded-Host $host;
       proxy_set_header X-Forwarded-Server $host;
       proxy_pass_request_body on;
       proxy_pass_request_headers on;
   }
   ```

2. Обновлены параметры CATALINA_OPTS для GeoServer Vector:
   ```yaml
   environment:
     - CATALINA_OPTS=-Dorg.geoserver.web.proxy.base=http://localhost/geoserver/vector/web -Dorg.geoserver.use.header.proxy=true -DGEOSERVER_CSRF_DISABLED=true
   ```

3. Создан скрипт для автоматической диагностики проблем с редиректами: `scripts/check-geoserver-redirect.ps1`

**Как проверить**:
```powershell
# Тестирование с подробным выводом
.\scripts\check-geoserver-redirect.ps1 -Test -Verbose

# Автоматическое исправление проблем
.\scripts\check-geoserver-redirect.ps1 -Fix
```

**Рекомендация по предотвращению**: Всегда используйте полностью квалифицированные URL для доступа к GeoServer:
- Для GeoServer Vector: `http://localhost/geoserver/vector/web/`
- Для GeoServer ECW: `http://localhost/geoserver/ecw/web/`

⚠️ Никогда не используйте сокращенный URL без указания инстанции: `http://localhost/geoserver/web/`

### Улучшение веб-интерфейса и поддержка растровых слоев

**Проблема**: Первоначальная версия веб-интерфейса имела ряд недостатков:
1. Весь JavaScript код был встроен непосредственно в HTML файл, что затрудняло поддержку
2. Отсутствовала обработка ошибок при загрузке слоев и базовой карты
3. Не было поддержки растровых слоев из GeoServer ECW
4. Стили CSS были встроены в HTML, что усложняло их модификацию
5. Отсутствовала темная тема и адаптивность для мобильных устройств

**Решение**:
1. **Реорганизация кода**:
   - Создан файл `src/web-interface/js/map.js` для основной логики карты
   - Создан файл `src/web-interface/js/layer-info.js` для работы с информацией о слоях
   - Создан файл `src/web-interface/css/main.css` для стилей интерфейса
   - HTML файл очищен от встроенного кода и подключает внешние ресурсы

2. **Улучшение обработки ошибок**:
   - Добавлена функция `tryNextBaseLayer()` для автоматического переключения на альтернативные базовые слои при ошибке загрузки
   - Реализована система уведомлений о проблемах с загрузкой слоев
   - Добавлена визуальная индикация недоступных слоев в панели управления

3. **Поддержка растровых слоев**:
   - Добавлена функция `checkRasterLayerAvailability()` для проверки доступности растрового слоя
   - Реализована функция `getLayerExtent()` для получения экстента слоя из GeoServer
   - Добавлена функция `zoomToRasterLayer()` для автоматического зуммирования к растровому слою
   - Создан скрипт `setup-raster-layer.ps1` для публикации растровых слоев в GeoServer

4. **Улучшение пользовательского интерфейса**:
   - Добавлена поддержка темной темы с переключателем
   - Улучшена адаптивность для мобильных устройств
   - Добавлены анимации и улучшена визуальная обратная связь
   - Реализована панель информации о слое с метаданными из GeoServer

5. **Дополнительные базовые слои**:
   - Добавлены альтернативные источники базовых карт (OpenStreetMap, Stamen, CartoDB)
   - Реализована система автоматического переключения при недоступности основного источника
   - Добавлена группировка слоев по категориям (базовые, векторные, растровые)

**Результат**:
- Повышена надежность и отказоустойчивость веб-интерфейса
- Улучшена организация кода, что упрощает дальнейшую разработку
- Добавлена поддержка растровых слоев с автоматическим определением экстента
- Улучшен пользовательский интерфейс с поддержкой темной темы
- Повышена адаптивность для различных устройств

**Пример использования растрового слоя**:
1. Публикация растрового слоя в GeoServer ECW:
   ```powershell
   .\scripts\setup-raster-layer.ps1 -GeoServerUrl "http://localhost/geoserver/ecw/rest" -AdminUser "admin" -AdminPassword "geoserver" -WorkspaceName "raster" -DatastoreName "ecw_store" -LayerName "satellite" -RasterFilePath "D:\data\imagery\satellite.ecw"
   ```

2. Автоматическое определение и отображение слоя в веб-интерфейсе:
   - Слой будет автоматически обнаружен и добавлен в панель слоев
   - Кнопка "Приблизить к слою" позволит автоматически зуммировать к экстенту растра
   - При клике на карте будет отображаться информация о точке (GetFeatureInfo)

## 📋 Лучшие практики ведения документации

### Ведение Storybook

Storybook-подход к документированию разработки имеет следующие преимущества:

1. **Хронологическое отслеживание** - позволяет сохранять историю разработки в хронологическом порядке
2. **Документирование решений** - фиксирует не только задачи, но и способы решения проблем
3. **Интеграция с Git** - хорошо сочетается с системой контроля версий
4. **Коллаборация** - помогает командам оставаться в курсе изменений

Рекомендации по ведению Storybook:
- **Регулярность** - обновляйте после завершения каждой значимой задачи
- **Детализация** - включайте достаточно деталей, чтобы понять контекст
- **Структурирование** - используйте разделы, таблицы и маркированные списки для удобства чтения
- **Ссылки** - добавляйте ссылки на документацию, коммиты и внешние ресурсы
- **Статус** - четко указывайте статус задач (✅, 🔄, ⚠️, ❌)

### Альтернативные инструменты для отслеживания прогресса

1. **Issues и Project Board в GitHub**
   - Отслеживание задач через систему issues
   - Визуальное управление с помощью канбан-досок
   - Автоматические обновления при связывании коммитов с задачами

2. **Wiki**
   - Расширенная документация с возможностью создания взаимосвязанных страниц
   - Хорошо подходит для объемной технической документации

3. **Changelog**
   - Ориентирован на фиксацию изменений в версиях для пользователей
   - Фокусируется на функциональных изменениях, а не на процессе разработки

4. **DevOps инструменты**
   - Azure DevOps, Jira, Trello для управления задачами
   - Интеграция CI/CD в процесс документирования

5. **Документация в коде**
   - Комментарии в коде с пометками TODO, FIXME
   - Docstrings для автоматической генерации документации

Наиболее эффективный подход - **комбинация нескольких инструментов**:
- **Storybook** - для документирования процесса и решений
- **GitHub Issues** - для отслеживания конкретных задач
- **Changelog** - для документирования изменений между версиями
- **Техническая документация в коде** - для API и интерфейсов

### Интеграция с CI/CD

Для автоматизации обновления документации рекомендуются следующие подходы:

1. **Автоматическое обновление статуса задач** при закрытии issues
2. **Автоматическая генерация Changelog** на основе коммитов с определенными метками
3. **Генерация документации API** на основе комментариев в коде
4. **Проверка актуальности документации** в рамках CI/CD пайплайна

Эти подходы позволяют сделать процесс документирования более эффективным и менее трудоемким, обеспечивая при этом актуальность и полноту документации.

## 📒 Планируемые задачи

1. **Реализовать автоматизированное тестирование всех компонентов**
   - Создать скрипт для проверки работоспособности всей системы
   - Интегрировать с системой CI/CD для автоматических проверок

2. **Разработать расширенный интерфейс администрирования**
   - Реализовать веб-интерфейс для управления GeoServer
   - Добавить визуализацию логов и мониторинг производительности

3. **Улучшить систему резервного копирования**
   - Реализовать инкрементальное резервное копирование
   - Добавить автоматическое восстановление из резервных копий

4. **Обновить документацию**
   - Создать руководство пользователя с примерами использования
   - Разработать руководство по установке на различных операционных системах

5. **Интеграция с внешними системами**
   - Добавить API для интеграции с корпоративными системами
   - Реализовать поддержку импорта/экспорта данных в различных форматах

6. **Расширить набор растровых слоев**
   - Добавить поддержку большего количества растровых форматов
   - Разработать интерфейс для сравнения разновременных растровых данных
   - Реализовать кеширование растровых слоев для повышения производительности

Никогда не используйте сокращенный URL без указания инстанции: `http://localhost/geoserver/web/`

## 📱 Проверка Django админ-панели

### Выполненные задачи:
1. **Настройка entrypoint.sh для автоматических миграций**
   - Обновлен скрипт `src/admin-panel/entrypoint.sh` для автоматического создания и применения миграций при запуске
   - Добавлены проверки доступности PostgreSQL перед запуском Django
   - Настроена автоматическая последовательность операций: миграции → создание суперпользователя → сбор статических файлов

2. **Отладка проблем с Django админ-панелью**
   - Исправлена проблема с импортом `SyncLayersView` в `urls.py`
   - Проверены и применены миграции для моделей `data_manager`
   - Перезапущен контейнер Django с полным обновлением для исключения проблем с кэшированием

3. **Проверка моделей и представлений**
   - Проверены определения моделей: `LayerMetadata`, `LayerCategory`, `AttributeMetadata`
   - Проанализирована структура представлений, включая важные классы: `LayerMetadataViewSet`, `SyncLayersView`
   - Проверены сериализаторы для преобразования данных между REST API и моделями Django

4. **Интеграция с GeoServer**
   - Анализ функциональности синхронизации метаданных с GeoServer через `SyncLayersView`
   - Просмотр логов для отладки процесса соединения Django с GeoServer

### Последовательность запуска Django-админки:
```bash
# 1. Остановка и удаление контейнеров для чистого запуска
docker-compose -f config/docker/dev/docker-compose.yml down -v

# 2. Запуск всех контейнеров
docker-compose -f config/docker/dev/docker-compose.yml up -d

# 3. Проверка логов Django-контейнера
docker logs gis-admin

# 4. Проверка доступности админ-панели
Invoke-WebRequest -Uri http://localhost:8000/admin/ -Method HEAD -UseBasicParsing
```

### Работа с моделями через Django админ-панель:
Для доступа к опубликованным растровым слоям в Django админке:
1. Перейти по адресу http://localhost:8000/admin/
2. Войти с учетными данными администратора
3. В разделе "Data_manager" выбрать "Метаданные слоев"
4. Для синхронизации с GeoServer использовать API эндпоинт `/api/data_manager/sync-geoserver/`

### Полезные команды для отладки Django:
```bash
# Проверка таблиц PostgreSQL
docker exec -it postgis psql -U postgres -d gis -c "\dt data_manager_*"

# Ручное создание миграций
docker exec -it gis-admin python manage.py makemigrations data_manager

# Ручное применение миграций
docker exec -it gis-admin python manage.py migrate data_manager

# Проверка URL маршрутов
docker exec -it gis-admin python manage.py show_urls
```







